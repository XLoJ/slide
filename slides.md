---
theme: ./theme
class: text-center
highlighter: prism
info: |
  ## åœ¨çº¿è¯„æµ‹ç³»ç»Ÿå¼€å‘åŠå‡çº§
  
  æ¯•ä¸šè®¾è®¡ç­”è¾©
default:
  highlighter: prism
---

# åœ¨çº¿è¯„æµ‹ç³»ç»Ÿå¼€å‘åŠå‡çº§

<div class="inline-block text-left mt-6">
  <div>
    <p class="flex justify-between"><div class="w-24 text-justify">æŠ¥å‘Šäººï¼š</div><div class="w-36 text-center">é¢œä¿Šæ¢</div></p> 
    <p class="flex justify-between"><div class="w-24 text-justify">å­¦å·ï¼š</div><div class="w-36 text-center">917106840244</div></p> 
    <p class="flex justify-between"><div class="w-24 text-justify">æŒ‡å¯¼è€å¸ˆï¼š</div><div class="w-36 text-center">ä½™ç«‹åŠŸ</div></p> 
  </div>
</div>

<!--
The last comment block of each slide will be treated as slide notes. It will be visible and editable in Presenter Mode along with the slide. [Read more in the docs](https://sli.dev/guide/syntax.html#notes)
-->

---
layout: Contents
---

# åœ¨çº¿è¯„æµ‹ç³»ç»Ÿå¼€å‘åŠå‡çº§

1. å¼•è¨€

2. ç³»ç»Ÿæ¨¡å—ä¸æ¶æ„

3. åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹

4. ç¨‹åºè®¾è®¡ç«èµ›è¯•é¢˜åˆ›å»ºç³»ç»Ÿ

---
layout: cover
class: text-center
---

# 1. å¼•è¨€

---
class: intro
---

# å¼•è¨€

<div v-click="1">
ç›®å‰ï¼Œè®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„å­¦ä¹ åœ¨ä¸–ç•ŒèŒƒå›´å†…æ€èµ·äº†çƒ­æ½®ï¼Œè¶Šæ¥è¶Šå¤šçš„äººæ¥è§¦åˆ°äº†è®¡ç®—æœºï¼Œå¼€å§‹å­¦ä¹ ç¨‹åºè®¾è®¡ã€‚

è®¡ç®—æœºä¸“ä¸šæ˜¯ä¸€é—¨ç†è®ºå’Œå®è·µç»“åˆååˆ†ç´§å¯†çš„å­¦ç§‘ã€‚
</div>

<p v-click="2">
åœ¨çº¿è¯„æµ‹ç³»ç»Ÿå¹¿æ³›åº”ç”¨äºè®¡ç®—æœºè¯¾ç¨‹çš„æ•™å­¦å’Œç¨‹åºè®¾è®¡ç«èµ›çš„è®­ç»ƒä¹‹ä¸­ã€‚
</p>

<div v-click="3">

```mermaid
sequenceDiagram
  autonumber
  participant ç”¨æˆ·
  participant åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ
  participant æµ‹è¯•æ•°æ®

  ç”¨æˆ· ->> åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ: ç¨‹åºä»£ç 
  activate åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ
  åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ ->> åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ: ç¼–è¯‘ä»£ç 
  æµ‹è¯•æ•°æ® ->> åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ: é¢˜ç›®æ•°æ®
  åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ ->> ç”¨æˆ·: ä½¿ç”¨æµ‹è¯•æ•°æ®è¿è¡Œä»£ç 
  deactivate åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ

```

</div>

<p v-click="4">
åœ¨æœ¬æ¯•ä¸šè®¾è®¡é¡¹ç›®ä¸­ï¼Œå¼€å‘äº†ä¸€ä¸ªå…¨æ–°çš„åœ¨çº¿è¯„æµ‹ç³»ç»Ÿï¼Œä¸ºå­¦ç”Ÿå­¦ä¹ å’Œè®­ç»ƒæä¾›ä¸€ä¸ªèˆ’é€‚çš„å¹³å°ã€‚
</p>

<!-- å¾ˆå¤šåœ¨çº¿è¯„æµ‹ç³»ç»Ÿå­˜åœ¨å„ç§å„æ ·çš„é—®é¢˜ï¼š

1. å­¦ç”Ÿä½¿ç”¨çš„è§’åº¦ä¸Šï¼Œç•Œé¢ç®€é™‹ï¼Œç¼ºä¹æ•°å­¦å…¬å¼ç­‰å†…å®¹çš„æ¸²æŸ“ï¼›ï¼ˆå›¾ç‰‡ï¼‰

2. ç®¡ç†å‘˜ä½¿ç”¨çš„è§’åº¦ä¸Šï¼Œç¼ºä¹ç”¨æˆ·è§’è‰²å’Œæƒé™ç®¡ç†æœºåˆ¶ï¼Œé¢˜ç›®åˆ›å»ºåŠŸèƒ½è¿‡äºç®€å•ï¼›

3. è¯„æµ‹ç³»ç»Ÿè®¾è®¡å®ç°çš„è§’åº¦ä¸Šï¼Œè¯„æµ‹èŠ‚ç‚¹ä¸æ”¯æŒåŠ¨æ€æ‰©å±•ï¼Œè¿è¡Œå­¦ç”Ÿæäº¤çš„ä»£ç æ—¶å¯èƒ½å­˜åœ¨å®‰å…¨éšæ‚£ã€‚ -->

---

<div class="flex justify-center mt-16">
  <img src="/home.png" alt="é¦–é¡µ" style="zoom: 32%;" />
</div>

<!-- # What is Slidev?

Slidev is a slides maker and presenter designed for developers, consist of the following features

- ğŸ“ **Text-based** - focus on the content with Markdown, and then style them later
- ğŸ¨ **Themable** - theme can be shared and used with npm packages
- ğŸ§‘â€ğŸ’» **Developer Friendly** - code highlighting, live coding with autocompletion
- ğŸ¤¹ **Interactive** - embedding Vue components to enhance your expressions
- ğŸ¥ **Recording** - built-in recording and camera view
- ğŸ“¤ **Portable** - export into PDF, PNGs, or even a hostable SPA
- ğŸ›  **Hackable** - anything possible on a webpage

<br>
<br>

Read more about [Why Slidev?](https://sli.dev/guide/why) -->

<!--
You can have `style` tag in markdown to override the style for the current page.
Learn more: https://sli.dev/guide/syntax#embedded-styles
-->

---
layout: cover
class: text-center
---

# 2. ç³»ç»Ÿæ¨¡å—ä¸æ¶æ„

---

# ç³»ç»Ÿæ¶æ„

<div class="flex justify-center">
  <img src="/struct.png" alt="ç³»ç»Ÿæ¶æ„" style="zoom:61%;" />
</div>

<!-- æœ¬é¡¹ç›®å¼€å‘çš„ç³»ç»ŸåŒ…å«ç”¨æˆ·äº¤äº’çš„ Web å‰ç«¯ï¼Œç³»ç»Ÿé€»è¾‘çš„å¤„ç†çš„ Web åç«¯ï¼Œåˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹å’Œå…¶å®ƒä¸€äº›æ•°æ®æŒä¹…åŒ–ä¸­é—´ä»¶ç­‰éƒ¨åˆ† -->

---

# ç³»ç»Ÿå®ç°

+ Web åç«¯ï¼šJVM å¹³å°ä¸Šçš„ Kotlin è¯­è¨€å’Œ Spring ç³»åˆ—æ¡†æ¶

+ Web å‰ç«¯ï¼šJavaScript è¯­è¨€å’Œå‰ç«¯æ¡†æ¶ Vue.js

+ Linux åˆ¤é¢˜æ²™ç›’ï¼šC++ è¯­è¨€

+ åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹ï¼šTypeScript è¯­è¨€å’Œ Node.js å¹³å°

---
clicks: 5
---

# åŠŸèƒ½æ¨¡å—

+ ç”¨æˆ·æ¨¡å— <mdi-arrow-right-bold v-click="1" class="inline-block" /> <span v-click="1" class="inline-block">æ³¨å†Œä¸ç™»å½•</span>

+ æ¯”èµ›æ¨¡å— <mdi-arrow-right-bold v-click="2" class="inline-block" /> <span v-click="2" class="inline-block">ç»„ç»‡çº¿ä¸Šæˆ–çº¿ä¸‹ç¨‹åºè®¾è®¡æ¯”èµ›</span>

+ é¢˜åº“æ¨¡å— <mdi-arrow-right-bold v-click="3" class="inline-block" /> <span v-click="3" class="inline-block">ç”¨æˆ·å¹³æ—¶çš„ç¼–ç¨‹ç»ƒä¹ </span>

+ è¯„æµ‹æ¨¡å— <mdi-arrow-right-bold v-click="4" class="inline-block" /> <span v-click="4" class="inline-block">è¯„æµ‹è¿è¡Œç”¨æˆ·æäº¤çš„ç¨‹åºä»£ç </span>

+ è¯•é¢˜åˆ›å»ºç³»ç»Ÿ <mdi-arrow-right-bold v-click="5" class="inline-block" /> <span v-click="5" class="inline-block">åˆ›å»ºç¨‹åºè®¾è®¡ç«èµ›è¯•é¢˜</span>

<style>
ul li {
  height: 2rem;
  line-height: 1;

  div {
    display: inline-flex;
    align-items: center;
  }
}
</style>

<!-- 
<div class="flex justify-center">
  <img src="/mod.png" alt="æ¨¡å—" style="zoom: 80%;" />
</div> -->


---
layout: cover
class: text-center
---

# 3. åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹

---

# åˆ¤é¢˜æ²™ç›’

åˆ¤é¢˜èŠ‚ç‚¹æ˜¯åœ¨çº¿è¯„æµ‹ç³»ç»Ÿçš„ **æ ¸å¿ƒéƒ¨åˆ†**ï¼Œä¹Ÿæ˜¯åœ¨çº¿è¯„æµ‹ç³»ç»Ÿä¸­ **æœ€è„†å¼±çš„éƒ¨åˆ†**ã€‚

<div v-click>
  <div class="inline-flex justify-center absolute left-10">
    <img src="/aplusb.png" alt="A + B" style="zoom:50%;" />
  </div>

  <div class="inline-flex justify-center absolute left-80 top-50">
    <img src="/ac.png" alt="AC" style="zoom:45%;" />
  </div>

  <div class="inline-flex justify-center absolute right-20 top-50">
    <img src="/rmrf.png" alt="rm -rf" style="zoom:45%;" />
  </div>
</div>

---

# æ²™ç›’å®‰å…¨

åˆ¤é¢˜èŠ‚ç‚¹ä¸å¯é¿å…åœ°éœ€è¦æ‰§è¡Œç”¨æˆ·å‘é€çš„ **ä¸å—ä¿¡ä»»çš„ä»£ç **ã€‚

è¿™äº›ä»£ç å¾ˆæœ‰å¯èƒ½ä¼šå¯¹æœåŠ¡å™¨è¿›è¡Œä¸€äº›æ”»å‡»æ“ä½œï¼š

+ æ–‡ä»¶ç³»ç»Ÿæ”»å‡»

+ éæ³•çš„ç½‘ç»œè¿æ¥

+ éæ³•çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ“ä½œ

+ ç¼–è¯‘å™¨æ”»å‡»

+ ......

<div v-click>

<br />

ä½¿ç”¨ C++ è¯­è¨€ï¼ŒLinux ç³»ç»Ÿå†…æ ¸æä¾›**å‘½åç©ºé—´å’Œ cgroups ç­‰æœºåˆ¶**ï¼Œå®ç°äº†ä¸€ä¸ª**åˆ¤é¢˜æ²™ç›’**ã€‚

</div>

<!-- 
```c++
int main() {
  struct x struct z<x(x(x(x(x(x(x(x(x(x(x(x(x(x(x(y,x(y><y*,x(y*w>v<y*,w,x{}
  return 0;
}
``` 
-->

---
class: intro2
---

# å‘½åç©ºé—´

å‘½åç©ºé—´æœºåˆ¶å®ç°äº†**å¯¹å„ç§ç³»ç»Ÿèµ„æºçš„éš”ç¦»**ã€‚

æŒ‚è½½ç‚¹å‘½åç©ºé—´ mnt å®ç°äº†å†…æ ¸çº§åˆ«çš„æ–‡ä»¶ç›®å½•éš”ç¦»ã€‚

```mermaid
graph TD
  A(åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶ mnt å‘½åç©ºé—´)
  B(ç”¨æˆ·è¿›ç¨‹åˆ‡æ¢åˆ°ä¸´æ—¶çš„ mnt å‘½åç©ºé—´ä¸‹)
  C(å°†å®¿ä¸»æœºçš„æ–‡ä»¶æ ¹ç›®å½•ä»ä¸­å‰”é™¤)
  D(ä½¿ç”¨ä¸€ä¸ªç©ºç›®å½•æ›¿æ¢ä¸ºè™šæ‹Ÿçš„æ ¹ç›®å½•)
  E(å°†è¿è¡Œç¨‹åºå¿…è¦çš„æ–‡ä»¶ä»¥åªè¯»å½¢å¼æŒ‚è½½åˆ°è™šæ‹Ÿæ ¹ç›®å½•ä¸­)
	A --> B
	B --> C
	C --> D
  D --> E
```

<!-- 
1. å‡†å¤‡ä¸€ä¸ªä¸´æ—¶çš„ç›®å½•ç”¨äºä½œä¸ºè™šæ‹Ÿçš„æ ¹ç›®å½•

2. åˆ›å»ºç¨‹åºè¿›ç¨‹æ—¶åˆ‡æ¢åˆ°æ²™ç›’æä¾›çš„ä¸´æ—¶ mnt å‘½åç©ºé—´å†…

2. å°†å®¿ä¸»æœºçš„æ–‡ä»¶ç›®å½•ä»ä¸´æ—¶å‘½åç©ºé—´ä¸­å‰”é™¤ï¼Œä½¿å¾—æ–°åˆ›å»ºçš„è¿›ç¨‹æ— æ³•è®¿é—®åŸæœ‰å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿ

3. å°†æå‰åˆ›å»ºå¥½çš„è™šæ‹Ÿæ ¹ç›®å½•æŒ‚è½½åˆ°æ–°è¿›ç¨‹å½“ä¸­ï¼Œå°†ç¨‹åºè¿è¡Œå¿…è¦çš„ç›®å½•åªè¯»åœ°æŒ‚è½½å›æ–°çš„å‘½åç©ºé—´ -->

<!--

å‘½åç©ºé—´


if (mount("/", "/", NULL, MS_REC | MS_PRIVATE, NULL) == -1) {
  PLOG_E("mount('/', '/', NULL, MS_REC|MS_PRIVATE, NULL)");
  return false;
}
if (mount(NULL, destdir->c_str(), "tmpfs", 0, "size=16777216") == -1) {
  PLOG_E("mount('%s', 'tmpfs')", destdir->c_str());
  return false;
}

-->

---

# CGroups

CGroups æœºåˆ¶å®ç°äº†å¯¹äº**è¿›ç¨‹èµ„æºçš„è¿½è¸ªå’Œé™åˆ¶**ï¼Œä¾‹å¦‚ CPUï¼Œå†…å­˜å’Œç£ç›˜ç­‰ã€‚

ä½¿ç”¨ setrlimit ç³»ç»Ÿè°ƒç”¨å¯ä»¥ç”¨æ¥é™åˆ¶è¿›ç¨‹çš„èµ„æºå ç”¨ã€‚

```cpp
struct rlimit64 rl;
rl.rlim_cur = rl.rlim_max = nsjconf->rl_as;
if (setrlimit64(RLIMIT_AS, &rl) == -1) {
   return false;
}
rl.rlim_cur = rl.rlim_max = nsjconf->rl_cpu;
if (setrlimit64(RLIMIT_CPU, &rl) == -1) {
   return false;
}
rl.rlim_cur = rl.rlim_max = nsjconf->rl_nproc;
if (setrlimit64(RLIMIT_NPROC, &rl) == -1) {
   return false;
}
```

<div class="absolute" style="top: 14.5rem; left: 22rem;"><mdi-arrow-right-bold class="inline-block pb-1" />åœ°å€ç©ºé—´å¤§å°</div> 

<div class="absolute" style="top: 19rem; left: 22rem;"><mdi-arrow-right-bold class="inline-block pb-1" />CPU æ—¶é—´</div> 

<div class="absolute" style="top: 24rem; left: 22rem;"><mdi-arrow-right-bold class="inline-block pb-1" />å­è¿›ç¨‹æ•°é‡</div> 

---

# åˆ¤é¢˜æ²™ç›’é˜²å¾¡å®ä¾‹

æ¶æ„ä»£ç è¯•å›¾æ‰§è¡Œ `rm -rf / --no-preserve-root` å‘½ä»¤åˆ é™¤æ–‡ä»¶ç³»ç»Ÿã€‚

```c
#include <stdlib.h>

int main() {
  system("rm -rf / --no-preserve-root");
}
```

<p v-click>
ä½¿ç”¨ strace è·Ÿè¸ªå®ƒæ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨ï¼š

```text
13202 1622479041.760245 execve("/usr/bin/rm", ["rm", "-rf", "/", "--no-preserve-root"], ...)
```
</p>

<p v-click>
ä½†æ˜¯ï¼Œæ‰€æœ‰æ‰§è¡Œåˆ é™¤çš„ç³»ç»Ÿè°ƒç”¨éƒ½å¤±è´¥äº†ï¼š

```text
13202 1622479041.787068 unlinkat(5, "protocols", 0) = -1 EROFS (Read-only file system)
13202 1622479041.787306 newfstatat(5, "protocols", {st_mode=S_IFREG|0644, st_size=2932, ...}, AT_SYMLINK_NOFOLLOW) = 0
13202 1622479041.787697 write(2, "rm: ", 4) = 4
13202 1622479041.787922 write(2, "cannot remove '/etc/protocols'", 30) = 30
13202 1622479041.788154 write(2, ": Read-only file system", 23) = 23
13202 1622479041.788375 write(2, "\n", 1) = 1
```
</p>

---

# åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹

è¿è¡Œé€‰æ‰‹æäº¤çš„ç¨‹åºä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´ã€‚

ä¸ºäº†æé«˜ååé‡ï¼Œè®©å¾ˆå¤šåˆ¤é¢˜æ²™ç›’åŒæ—¶å·¥ä½œã€‚

<div v-click>

å¼•å‡ºäº†ä¸‰ä¸ªé—®é¢˜ï¼š

+ åˆ¤é¢˜èŠ‚ç‚¹ä¸ Web åç«¯ä¹‹é—´çš„é€šä¿¡

+ åˆ¤é¢˜èŠ‚ç‚¹ä¹‹é—´çš„å¹¶å‘è°ƒåº¦

+ åˆ¤é¢˜èŠ‚ç‚¹ä¸­é¢˜ç›®æ•°æ®çš„è·å–

</div>

---
layout: Mermaid
---

# é¢˜ç›®è¯„æµ‹æµç¨‹

<!-- <div class="flex justify-center">
  <img src="/struct.png" alt="ç³»ç»Ÿæ¶æ„" style="zoom:61%;" />
</div> -->

```mermaid
sequenceDiagram
  autonumber
  participant Web å‰ç«¯
  participant Web åç«¯
  participant åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹
  participant MinIO å¯¹è±¡å­˜å‚¨
  Web å‰ç«¯ ->> Web åç«¯: ç”¨æˆ·å‘èµ·è¯„æµ‹è¯·æ±‚
  Note over Web åç«¯, åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹: Rabbit MQ æ¶ˆæ¯é˜Ÿåˆ—
  Web åç«¯ ->> åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹: JSON æ ¼å¼è¯„æµ‹æ¶ˆæ¯
  loop è¯„æµ‹
    activate åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹
    åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹ ->> MinIO å¯¹è±¡å­˜å‚¨: æµ‹è¯•æ•°æ®ç¼ºå¤±
    MinIO å¯¹è±¡å­˜å‚¨ -->> åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹: ä¸‹è½½æµ‹è¯•æ•°æ®
    åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹ -->> Web åç«¯: è¯„æµ‹ç»“æœ
    Web åç«¯ ->> Web åç«¯: æ›´æ–°æäº¤çŠ¶æ€
    deactivate åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹
  end
  loop è¿è¡ŒçŠ¶æ€
    Web å‰ç«¯ ->> Web åç«¯: æŸ¥è¯¢
    Web åç«¯ -->> Web å‰ç«¯: æäº¤ä»£ç è¿è¡ŒçŠ¶æ€
  end
```

---

# åˆ†å¸ƒå¼åˆ¤é¢˜èŠ‚ç‚¹

<div class="flex justify-center mt-16">
  <img src="/judge.png" alt="è¯„æµ‹" style="zoom: 50%;" />
</div>

---
layout: cover
class: text-center
---

# 4. ç¨‹åºè®¾è®¡ç«èµ›è¯•é¢˜åˆ›å»ºç³»ç»Ÿ

---

# ç¨‹åºè®¾è®¡ç«èµ›è¯•é¢˜åˆ›å»ºç³»ç»Ÿ

ä¼ ç»Ÿçš„åœ¨çº¿è¯„æµ‹ç³»ç»Ÿä¸­çš„é¢˜ç›®åˆ›å»ºéƒ½æ˜¯ç®€å•åœ°ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ çš„æ–¹å¼è¿›è¡Œçš„ã€‚

å­˜åœ¨çš„é—®é¢˜ï¼š

1. ç”¨æˆ·ä¸Šä¼ é”™è¯¯çš„æ–‡ä»¶

2. æ— æ³•ä¿è¯ä¸Šä¼ æ•°æ®çš„è¾“å…¥æ˜¯ç¬¦åˆæœŸæœ›çš„

3. å‡ºé¢˜äººçš„æœ¬åœ°è¿è¡Œç¯å¢ƒå’Œè¯„æµ‹èŠ‚ç‚¹çš„è¿è¡Œç¯å¢ƒä¸ä¸€è‡´

---

# ç¨‹åºè®¾è®¡ç«èµ›è¯•é¢˜åˆ›å»ºç³»ç»Ÿ

<div class="flex justify-center">
  <img src="/polygon.png" alt="polygon" style="zoom:36%;" />
</div>

---

# æ•°æ®åº“

```kotlin
interface User : Entity<User> {
  companion object : Entity.Factory<User>()
  var id: Long
  var username: String
  var nickname: String
  var password: String
}
object Users : Table<User>("users") {
  val id = long("id").primaryKey().bindTo { it.id }
  val username = text("username").bindTo { it.username }
  val nickname = text("nickname").bindTo { it.nickname }
  val password = text("password").bindTo { it.password }
}
```

---

# æ•°æ®åº“

```kotlin
database.users.find { it.id eq id }
```

```sql
select * from users where username = 'admin'
```

---

# Rest API

```kotlin
@RestController
@RequestMapping("/")
class UserController(
  private val userService: UserService
) {
  @PostMapping("/login")
  fun login(@Valid @RequestBody loginDto: UserLoginDto): UserLoginResponse {
    return userService.login(loginDto.username, loginDto.password)
  }
  @GetMapping("/profile")
  fun getMyProfile(@RequestAttribute user: UserProfile): UserProfile {
    return user
  }
}
```

---

# è¿‡æ»¤å™¨

```kotlin
class UserAuthFilter(
  private val jwtService: JWTService,
  private val userRepository: UserRepository
) : Filter {
  override fun doFilter(
    request: ServletRequest, response: ServletResponse, chain: FilterChain
  ) {
    val req = request as HttpServletRequest
    val auth = req.getHeader(HttpHeaders.AUTHORIZATION)
    if (auth != null) {
      val optionalUsername = jwtService.verify(auth)
      if (optionalUsername.isPresent) {
        chain.doFilter(request, response)
      } else {
        makeUnAuthorizeResponse(response, "JWT é”™è¯¯")
      }
    } else {
      makeUnAuthorizeResponse(response, "å°šæœªç™»å½•")
    }
  }
}
```

---

# è¯•é¢˜åˆ›å»ºæµç¨‹

1. è®¾ç½®è¯•é¢˜å…ƒä¿¡æ¯ï¼Œå³æ—¶é—´é™åˆ¶å’Œç©ºé—´é™åˆ¶çš„ä¿¡æ¯ï¼Œä»¥åŠé¢˜é¢æè¿°ä¿¡æ¯ã€‚

2. ä¸Šä¼ è¯•é¢˜æ­£ç¡®è§£æ³•ä»£ç å’Œå…¶å®ƒéœ€è¦æµ‹è¯•çš„è§£æ³•ä»£ç 

3. ä¸Šä¼ è¯•é¢˜çš„è¾“å…¥æ•°æ®æ ¡éªŒå™¨ä»£ç ï¼Œå¹¶å¯¹æ•°æ®æ ¡éªŒå™¨è¿›è¡Œæµ‹è¯•

4. ä¸Šä¼ è¯•é¢˜é™æ€æ•°æ®å’Œç›¸å…³æ•°æ®ç”Ÿæˆå™¨ä»£ç ï¼Œé…ç½®æ•°æ®ç”Ÿæˆå™¨çš„ç”Ÿæˆå‘½ä»¤ã€‚

5. è¿è¡Œè¯•é¢˜çš„ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹

---

# è¯•é¢˜æ„å»º

<div class="flex justify-center">
  <img src="/flow.png" alt="flow" style="zoom:50%;" />
</div>

---

# è¯•é¢˜æ›´æ–°

1. å¤„ç†é¢˜ç›®ä¿®æ”¹è¯·æ±‚ï¼Œè·å–å¾…ä¿®æ”¹çš„é¢˜ç›®ç¼–å·å’Œä¿®æ”¹çš„å†…å®¹ï¼›

2. è¿›è¡Œæ•°æ®åº“çš„æ›´æ–°æ“ä½œï¼›

3. å¦‚æœæ˜¯ä»£ç æˆ–è€…é™æ€æ•°æ®ï¼Œåˆ™è¦å°†ä»£ç å’Œé™æ€æ•°æ®ä¸Šä¼ è‡³ MinIO å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ä¸­ã€‚

---

# è¯•é¢˜å¹¶å‘æ›´æ–°

æµ‹è¯•æ•°æ®æ–‡ä»¶éå¸¸å¤§ã€‚

$10^6$ ä¸ªæ­£æ•´æ•°çš„æµ‹è¯•æ•°æ®æ–‡ä»¶å¤§å°æœ‰ $30$ MBã€‚

ç”Ÿæˆï¼Œä¸Šä¼ å’Œä¸‹è½½æµ‹è¯•æ•°æ®å°†ä¼šæ¶ˆè€—å¤§é‡æ—¶é—´ã€‚

å°†ä¼šæš´éœ²å‡ºå·¨å¤§çš„æ•°æ®ç«äº‰å¹¶å‘æ¼æ´ã€‚

---
layout: cover
---

<div class="flex justify-center items-center">
  <div>
    <h1 class="text-center">æ„Ÿè°¢</h1>
    <h4 class="text-center">é¢œä¿Šæ¢</h4>
  </div>
</div>
